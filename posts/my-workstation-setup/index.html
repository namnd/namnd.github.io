<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>My workstation setup - namnd ☕</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="My workstation setup"><meta property="og:description" content="I believe WFH is going to be (if not already) a new normal for the tech industry. The benefits of it undeniably outweigh some of its disadvantages."><meta property="og:type" content="article"><meta property="og:url" content="/posts/my-workstation-setup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-17T10:02:33+11:00"><meta property="article:modified_time" content="2023-01-17T10:02:33+11:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="My workstation setup"><meta name=twitter:description content="I believe WFH is going to be (if not already) a new normal for the tech industry. The benefits of it undeniably outweigh some of its disadvantages."><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600&family=Nanum+Gothic:wght@400;700;800&display=swap" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><script src=/js/feather.min.js></script>
<script src=/js/main.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8LL0B59QRS"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8LL0B59QRS",{anonymize_ip:!1})}</script></head><body><div class="container wrapper post"><div class=header><base href=/><h1 class=site-title><a href=/>namnd ☕</a></h1><div class=site-description><h2>personal blog</h2><nav class="nav social"><ul class=flat><a href=https://github.com/namnd title=Github><i data-feather=github></i></a><a href=https://twitter.com/fishsauc3 title=Twitter><i data-feather=twitter></i></a><a href=/index.xml title=RSS><i data-feather=rss></i></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>Posts</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div><div class=post-header><h1 class=title>My workstation setup</h1><div class=meta>Posted at &mdash; Jan 17, 2023</div></div><div class=markdown><p>I believe WFH is going to be (if not already) a new normal for the tech industry.
The benefits of it undeniably outweigh some of its disadvantages.
However, in my opinion, there is one major problem with WFH, that is security compliance.
There are enough stories, or articles about this, so I am not going to explain why that is the case.
Instead, I want to share my own setup, as an effort to have a reasonably secure and compliance workstation at home.</p><p>The amount of information for this setup is quite a lot.
Compress them all in one long post could make it unpleasant to follow, so I will split into multiple posts. This is <strong>Part 1</strong> of the series.</p><h2 id=hardwares>Hardwares</h2><ul><li>Macbook M1 Pro (16-inch, 2021)</li><li>YubiKey 5C Nano</li></ul><h2 id=softwares>Softwares</h2><ul><li><a href=https://gnupg.org/>GnuPG</a></li><li><a href=https://www.passwordstore.org/>pass</a></li></ul><p>The first and foremost thing I do whenever setting up a new workstation is to get the GPG key setup properly.
Hence in the first part of the series, I will talk about GPG and Yubikey.</p><p><em>Disclaimer:</em> There are a few different ways to do this. This is just my personal preference.</p><h2 id=step-1-generate-a-gpg>Step 1: Generate a GPG</h2><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gpg --full-generate-key --expert
</span></span></code></pre></div><p>A few notes</p><ul><li>I prefer ECC over RSA.</li><li>I also prefer to have a single master key just for <strong>C</strong>ertify, and three subkeys: one <strong>A</strong>uthentication only for SSH authentication, one <strong>E</strong>ncrypt only for password store, and another <strong>S</strong>igning only for signing git commits.</li><li>I do use passphrases for the the master key, but not for the subkeys as I will use Yubikey PIN code for subkeys.</li><li>I do use multiple identities for a single primary key, i.e. one for my personal usage (<a href=mailto:me@namnd.com>me@namnd.com</a>), another one for my current workplace. Some people might say this is not good practice, but I feel like it&rsquo;s just personal preference. It might also depend on the company&rsquo;s policy. My company is pretty flexible about this. I&rsquo;m also ok with being identified and associated with the company.
After all, there is <code>gpg> adduid</code> command for a reason, right?</li><li>Most importantly, I do not keep the master key in the Macbook. I backed it up in an encrypted USB stick and keep it in a safe place.
I only keep <strong>A</strong>uthentication, <strong>E</strong>ncrypt, and <strong>S</strong>igning subkeys in Yubikey.</li></ul><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#586e75># Export all keys to USB stick(s)</span>
</span></span><span style=display:flex><span>$ gpg --armor --output /Volumes/Superkey/gpg-keys.txt --export-secret-key me@namnd.com 
</span></span><span style=display:flex><span><span style=color:#586e75># Export subkeys to a temporary file</span>
</span></span><span style=display:flex><span>$ gpg --armor --output ./secret-subkeys.txt --export-secret-subkeys me@namnd.com
</span></span><span style=display:flex><span><span style=color:#586e75># Delete the whole key</span>
</span></span><span style=display:flex><span>$ gpg --delete-secret-key me@namnd.com
</span></span><span style=display:flex><span><span style=color:#586e75># Re-import subkeys</span>
</span></span><span style=display:flex><span>$ gpg --import ./secret-subkeys.txt
</span></span><span style=display:flex><span><span style=color:#586e75># The master key now should have the hash (#) sign to indicate it&#39;s being stored somewhere else</span>
</span></span><span style=display:flex><span>$ gpg --list-secret-keys
</span></span><span style=display:flex><span>sec#  ed25519/A8579128...
</span></span></code></pre></div><h2 id=step-2-import-subkeys-to-yubikey>Step 2: Import subkeys to Yubikey</h2><p>First, check card status with command</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gpg --card-status
</span></span></code></pre></div><p>Make sure <strong>Key attributes</strong> is <em>ed25519 cv25519 ed25519</em> since we use ECC for all GPG keys.</p><p>Run following commands to import subkeys to Yubikey</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gpg --edit-key E078ECC765D900C33AEDD9F7A85791287A30BB7D
</span></span><span style=display:flex><span>gpg&gt; key <span style=color:#2aa198>1</span>
</span></span><span style=display:flex><span>gpg&gt; keytocard
</span></span><span style=display:flex><span>Please <span style=color:#719e07>select</span> where to store the key:
</span></span><span style=display:flex><span>   <span style=color:#719e07>(</span>1<span style=color:#719e07>)</span> Signature key
</span></span><span style=display:flex><span>   <span style=color:#719e07>(</span>2<span style=color:#719e07>)</span> Encryption key
</span></span><span style=display:flex><span>   <span style=color:#719e07>(</span>3<span style=color:#719e07>)</span> Authentication key
</span></span><span style=display:flex><span>Your selection? <span style=color:#2aa198>1</span> <span style=color:#586e75># make sure you select the right destination for each key</span>
</span></span><span style=display:flex><span>... Repeat above <span style=color:#719e07>for</span> other subkeys
</span></span><span style=display:flex><span><span style=color:#586e75># Export public key</span>
</span></span><span style=display:flex><span>$ gpg --armor --export me@namnd.com &gt; public-key
</span></span><span style=display:flex><span><span style=color:#586e75># At this point, we should have master key secret in USB, subkeys in Yubikey, public key temp file</span>
</span></span><span style=display:flex><span>$ rm -rf ~/.gnupg
</span></span><span style=display:flex><span><span style=color:#586e75># Import public key</span>
</span></span><span style=display:flex><span>$ gpg --import ./public-key
</span></span><span style=display:flex><span>$ All subkeys should have an arrow <span style=color:#719e07>(</span>&gt;<span style=color:#719e07>)</span> sign to indicate they are being stored in Yubikey
</span></span><span style=display:flex><span>$ gpg --list-secret-keys
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>ssb&gt;  ed25519 2023-01-17 <span style=color:#719e07>[</span>S<span style=color:#719e07>]</span> <span style=color:#719e07>[</span>expires: 2024-01-17<span style=color:#719e07>]</span>
</span></span><span style=display:flex><span>ssb&gt;  ed25519 2023-01-17 <span style=color:#719e07>[</span>A<span style=color:#719e07>]</span> <span style=color:#719e07>[</span>expires: 2024-01-17<span style=color:#719e07>]</span>
</span></span><span style=display:flex><span>ssb&gt;  cv25519 2023-01-21 <span style=color:#719e07>[</span>E<span style=color:#719e07>]</span> <span style=color:#719e07>[</span>expires: 2024-01-21<span style=color:#719e07>]</span>
</span></span></code></pre></div><p>Now we are ready to use Yubikey</p><p>Note: if for some reason, you want to delete GPG records in Yubikey, follow this <a href=https://support.yubico.com/hc/en-us/articles/360013761339-Resetting-the-OpenPGP-Applet-on-the-YubiKey>instruction</a></p><p>TL;DR</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gpg --card-status
</span></span><span style=display:flex><span>$ gpg-connect-agent --hex
</span></span><span style=display:flex><span>&gt; scd apdu <span style=color:#2aa198>00</span> <span style=color:#2aa198>20</span> <span style=color:#2aa198>00</span> <span style=color:#2aa198>81</span> <span style=color:#2aa198>08</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#586e75># Repeat until &#34;D[0000]  69 83&#34;</span>
</span></span><span style=display:flex><span>&gt; scd apdu <span style=color:#2aa198>00</span> <span style=color:#2aa198>20</span> <span style=color:#2aa198>00</span> <span style=color:#2aa198>83</span> <span style=color:#2aa198>08</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>40</span> <span style=color:#586e75># Repeat until &#34;D[0000]  69 83&#34;</span>
</span></span><span style=display:flex><span>&gt; scd apdu <span style=color:#2aa198>00</span> e6 <span style=color:#2aa198>00</span> <span style=color:#2aa198>00</span> <span style=color:#586e75># Should see &#34;D[0000]  90 00&#34;</span>
</span></span><span style=display:flex><span>&gt; scd apdu <span style=color:#2aa198>00</span> <span style=color:#2aa198>44</span> <span style=color:#2aa198>00</span> <span style=color:#2aa198>00</span> <span style=color:#586e75># Should see &#34;D[0000]  90 00&#34;</span>
</span></span></code></pre></div><h2 id=step-3-use-gpg-key-for-ssh-authentication>Step 3: Use GPG key for SSH authentication</h2><p>First, get the keygrip of the <strong>A</strong>uthentication key with command</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gpg -K --with-keygrip
</span></span></code></pre></div><p>Grab the Keygrip of <strong>A</strong>uthentication key and put it into <code>~/.gnupg/sshcontrol</code></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ echo ECC7FCDCAB73B03C6DB54DDB04C88772536E20ED &gt; ~/.gnupg/sshcontrol
</span></span></code></pre></div><p>Next, enable SSH support for <strong>gpg-agent</strong></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ echo enable-ssh-support &gt;&gt; ~/.gnupg/gpg-agent.conf
</span></span></code></pre></div><p>Lastly, update shell (zsh) config by adding the below</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ cat ~/.zshrc
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)
</span></span></code></pre></div><p>To get public SSH key, run command</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ssh-add -L
</span></span></code></pre></div><h2 id=step-4-password-store>Step 4: Password store</h2><p>GPG/SSH keys are great. However, it&rsquo;s impossible to avoid plain text passwords. For this, I use <a href=https://www.passwordstore.org/>pass</a> with the GPG <strong>E</strong>ncrypt subkey. It&rsquo;s super simple, secure, and has everything things I need for a password management tool.</p><p>I do use a private remote repository to keep all passwords in sync between my devices.</p><p>That should be enough for <strong>Part 1</strong>. At this point, in order to read/write a password, or to have access to my github, one must have access to my Yubikey which is also protected by a PIN code. It might not look obvious how centric and secure this setup is yet. Hopefully, by the end of series, it will make more sense. In the next part, we will talk about Nix OS and Virtual machines.</p><h2 id=references--credits>References & credits</h2><ul><li><a href=https://github.com/YubicoLabs/sign-git-commits-yubikey>https://github.com/YubicoLabs/sign-git-commits-yubikey</a></li><li><a href=https://opensource.com/article/19/4/gpg-subkeys-ssh>https://opensource.com/article/19/4/gpg-subkeys-ssh</a></li><li><a href=https://rzetterberg.github.io/yubikey-gpg-nixos.html>https://rzetterberg.github.io/yubikey-gpg-nixos.html</a></li></ul></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/tags/wfh>wfh</a></li><li><a href=/tags/security>security</a></li><li><a href=/tags/compliance>compliance</a></li><li><a href=/tags/gpg>gpg</a></li><li><a href=/tags/ssh>ssh</a></li><li><a href=/tags/yubikey>yubikey</a></li></ul></nav></div><hr style=border-color:#f4f4f4><script src=https://giscus.app/client.js data-repo=namnd/namnd.github.io data-repo-id=R_kgDOIuwbYQ data-category="Blog comments" data-category-id=DIC_kwDOIuwbYc4CTmoW data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async></script></div><div class="footer wrapper"><nav class=nav><div>© Copyright namnd.com | <a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div><script>feather.replace()</script></body></html>